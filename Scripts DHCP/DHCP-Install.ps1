#Pour chaque symbole mal interprété mettre un espace invisible avant ou après 
#il est entre les parenthèses (ㅤ)
$fck = "╭∩╮(･◡･)╭∩╮"
$sym  = "➵ ➳ ⇥ → ➥ ◈ ↩"
$ScriptName = $MyInvocation.MyCommand.Name
Install-Module PSWriteColor
Import-Module PSWriteColor

$text = @"
                                                            
                          ▓▓▓▓▓▓▓▓▓▓▓▓▓▓        ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         
                         ▓▓        ▓▓▒▒▓▓      ▓▓           ▓▓▓▓        
                         ▓▓        ▓▓▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓       ▓▓▒▒▓▓       
                        ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▓▓▓     ▓▓       ▓▓▒▒▓▓       
                        ▓▓           ▓▓░░░▓▓      ▓▓      ▓▓▒▒▒▒▓▓      
                       ▓▓            ▓▓░░░▓▓     ▓▓       ▓▓▒▒▒▒▒▓▓     
                      ▓▓▓           ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▓▓    
                      ▓▓                                 ▓▓▒▒▒▒▒▒▓▓     
                     ▓▓                                 ▓▓▒▒▒▒▒▒▒▓▓     
                     ▓▓         ▓▓▓▓▓     ▓▓▓▓▓         ▓▓▒▒▒▒▒▒▒▓▓     
                    ▓▓▓▓▓▓▓    ▓▓▒▒▓▓    ▓▓▓▓▓▓        ▓▓▒▒▒▒▒▒▒▓▓      
                   ▓▓▓   ▓▓    ▓▓▒▒▓▓   ▓▓   ▓▓        ▓▓▒▒▒▒▒▒▒▓▓      
                   ▓▓   ▓▓▓▓▓▓▓▓▒▒▒▓   ▓▓▓  ▓▓        ▓▓▒▒▒▒▒▒▒▓▓       
                  ▓▓    ▓▓    ▓▓▒▒▓▓   ▓▓   ▓▓        ▓▓▒▒▒▒▒▒▒▓▓       
                  ▓▓   ▓▓▓▓▓▓▓▓▒▒▒▓▓▓▓▓▓   ▓▓        ▓▓░░░░░░░▓▓        
                 ▓▓         ▓▓▒▒▒▒▒▒▓▓     ▓▓        ▓▓░░░░░░░▓▓        
                 ▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▓▓   ▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░▒▓▓        
                  ▓▓         ▓▓░░░░░░░▓▓▓            ▓▓▒░░░░░▓▓         
                   ▓▓         ▓▓▒░░░░░▓▓▓▓▓▓▓         ▓▓▓░░░░▓▓         
                    ▓▓▓        ▓▓▓░░░▓▓     ▓▓          ▓▓░░▓▓          
                      ▓▓         ▓▓░▓▓       ▓▓          ▓▓▓▓▓          
                       ▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓           
                                                     
"@

$text2 = @"
╔═════════════════════════════════════════════════════════════════════════════════════╗ 
║                                   $ScriptName                                  ║
╚═════════════════════════════════════════════════════════════════════════════════════╝
"@

Clear-Host
Write-Host $text
Write-Host  
Write-Host $text2 

# Vérif si j'ai lancé le script en admin
$currentPrincipal = New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())
$ME = $currentPrincipal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)

if ( $ME -eq $false ) {
    write-host 
    write-host -ForegroundColor Red "LE SCRIPT DOIT ETRE LANCE DANS UN POWERSHELL AVEC LES DROITS ADMINISTRATEURS"
    exit
}
else {
    write-host -NoNewline '▌ㅤScript lancé dans un shell Administrateurs ➞  '
    Write-Host -ForegroundColor Green 'OK' 
}

$name = ""
while ($name -eq "") {

            $name = Read-Host "Renseigner le nom du serveur (Ex : DC01.test.fr) "

            }

Install-WindowsFeature DHCP -IncludeManagementTools
Add-DHCPServerInDC -DNSName $name

# Créer une nouvelle étendue DHCP
$ScopeName = ""
while ($ScopeName -eq "") {

            $ScopeName = Read-Host "Renseigner le nom de l'étendue (Ex : 192.168.1.0) "

            }

$Subnet = ""
while ($Subnet -eq "") {

            $Subnet = Read-Host "Renseigner l'adresse réseau de la plage DHCP (Ex : 192.168.1.0) "

            }

$SubnetMask = ""
while ($SubnetMask -eq "") {

            $SubnetMask = Read-Host "Renseigner le masque (Ex : 255.255.255.0) "

            }

$RangeStart = ""
while ($RangeStart -eq "") {

            $RangeStart = Read-Host "Renseigner le début de la plage DHCP (Ex : 192.168.1.10) "

            }

$RangeEnd = ""
while ($RangeEnd -eq "") {

            $RangeEnd = Read-Host "Renseigner la fin de la plage DHCP (Ex : 192.168.1.200) "

            }

$DefaultGateway = ""
while ($DefaultGateway -eq "") {

            $DefaultGateway = Read-Host "Renseigner la passerelle par défaut de la plage DHCP (Ex : 192.168.1.1) "

            }

$DNSServer = ""
while ($DNSServer -eq "") {

            $DNSServer = Read-Host "Renseigner le serveur DNS de la plage DHCP (Ex : 192.168.1.2) "

            }

$DNSSuffix = ""
while ($DNSSuffix -eq "") {

            $DNSSuffix = Read-Host "Renseigner le nom de domaine (Ex : test.fr) "

            }

Add-DhcpServerv4Scope -Name $ScopeName -StartRange $RangeStart -EndRange $RangeEnd -SubnetMask $SubnetMask -LeaseDuration 8.0:0:0 -State Active

Set-DhcpServerv4OptionValue -Router $DefaultGateway -DnsServer $DNSServer -DnsDomain $DNSSuffix

netsh dhcp add securitygroups

Set-ItemProperty –Path registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ServerManager\Roles\12 –Name ConfigurationState –Value 2